"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4510],{14510:(e,r,t)=>{t.d(r,{L:()=>c});var n=t(14232),a=t(10553),s=t(46264),c=function(){var e="authenticated"===(0,a.useSession)().status,r=(0,s.p)(),t=r.initializeFavorites,c=r.isInitialized;return(0,n.useEffect)(function(){e&&!c&&t()},[e,t,c]),{isAuthenticated:e}}},43107:(e,r,t)=>{t.d(r,{Eb:()=>k,F1:()=>l,FB:()=>f,LF:()=>i,Xc:()=>v,YE:()=>g,db:()=>h,mO:()=>d,nz:()=>p,tu:()=>b,y4:()=>m});var n=t(63857),a=t(43081),s=t.n(a);t(72185);var c=t(51695),u=t(91040),o=t(36423),i=function(){var e=(0,n.A)(s().mark(function e(){var r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.A.get("/templates/all");case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),p=function(){var e=(0,n.A)(s().mark(function e(){var r,t,n,a,u=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>0&&void 0!==u[0]?u[0]:{},e.prev=1,t=new URLSearchParams,r.limit&&t.append("limit",r.limit.toString()),r.lastKey&&t.append("lastKey",r.lastKey),r.category&&t.append("category",r.category),r.search&&t.append("search",r.search),r.status&&t.append("status",r.status),n="/admin/templates".concat(t.toString()?"?".concat(t.toString()):""),e.next=11,c.A.get(n);case 11:return a=e.sent,e.abrupt("return",a.data);case 15:return e.prev=15,e.t0=e.catch(1),console.error("Error fetching admin templates:",e.t0),e.abrupt("return",{success:!1,templates:[],message:"Kh\xf4ng thể tải danh s\xe1ch template"});case 19:case"end":return e.stop()}},e,null,[[1,15]])}));return function(){return e.apply(this,arguments)}}(),l=function(){var e=(0,n.A)(s().mark(function e(r){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.A.delete("/admin/templates/".concat(r));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error deleting template:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể x\xf3a template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}(),f=function(){var e=(0,n.A)(s().mark(function e(r,t){var n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.A.patch("/admin/templates/".concat(r,"/status"),{status:t});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error updating template status:",e.t0),e.abrupt("return",{success:!1,template:null,message:"Kh\xf4ng thể cập nhật trạng th\xe1i template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r,t){return e.apply(this,arguments)}}(),v=function(){var e=(0,n.A)(s().mark(function e(r){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.A.post("".concat(o.A.API_URL,"/templates/").concat(r,"/views"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error increasing template views:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể cập nhật số lượt xem template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}(),h=function(){var e=(0,n.A)(s().mark(function e(r){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.A.post("".concat(o.A.API_URL,"/templates/").concat(r,"/usages"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error increasing template usages:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể cập nhật số lượt sử dụng template"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}(),m=function(){var e=(0,n.A)(s().mark(function e(r){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.A.post("/users/favorites/templates",{templateId:r});case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error adding template to favorites:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể th\xeam v\xe0o danh s\xe1ch y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}(),d=function(){var e=(0,n.A)(s().mark(function e(r){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.A.delete("/users/favorites/templates/".concat(r));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error removing template from favorites:",e.t0),e.abrupt("return",{success:!1,message:"Kh\xf4ng thể x\xf3a khỏi danh s\xe1ch y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}(),g=function(){var e=(0,n.A)(s().mark(function e(){var r,t,n,a=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},e.prev=1,t=new URLSearchParams,r.limit&&t.append("limit",r.limit.toString()),r.lastEvaluatedKey&&t.append("lastEvaluatedKey",r.lastEvaluatedKey),e.next=7,c.A.get("/users/favorites/templates".concat(t.toString()?"?".concat(t.toString()):""));case 7:return n=e.sent,e.abrupt("return",n.data);case 11:return e.prev=11,e.t0=e.catch(1),console.error("Error fetching favorite templates:",e.t0),e.abrupt("return",{success:!1,templates:[],message:"Kh\xf4ng thể lấy danh s\xe1ch template y\xeau th\xedch"});case 15:case"end":return e.stop()}},e,null,[[1,11]])}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,n.A)(s().mark(function e(){var r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.A.get("/users/favorites/templates/ids");case 3:return r=e.sent,e.abrupt("return",r.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error fetching favorite template IDs:",e.t0),e.abrupt("return",{success:!1,templateIds:[],message:"Kh\xf4ng thể lấy danh s\xe1ch ID template y\xeau th\xedch"});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,n.A)(s().mark(function e(r){var t,n,a,c,i=arguments;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},e.prev=1,n=new URLSearchParams,t.page&&n.append("page",t.page.toString()),t.pageSize&&n.append("pageSize",t.pageSize.toString()),a="".concat(o.A.API_URL,"/templates/category/").concat(r).concat(n.toString()?"?".concat(n.toString()):""),e.next=8,u.A.get(a);case 8:return c=e.sent,e.abrupt("return",c.data);case 12:return e.prev=12,e.t0=e.catch(1),console.error("Error fetching templates by category:",e.t0),e.abrupt("return",{success:!1,templates:[],pagination:{total:0,currentPage:t.page||1,pageSize:t.pageSize||10},message:"Kh\xf4ng thể tải danh s\xe1ch template theo danh mục"});case 16:case"end":return e.stop()}},e,null,[[1,12]])}));return function(r){return e.apply(this,arguments)}}()},46264:(e,r,t)=>{t.d(r,{p:()=>i});var n=t(44478),a=t(63857),s=t(43081),c=t.n(s),u=t(8106),o=t(43107),i=(0,u.v)(function(e,r){var t,s,u,i;return{favoriteIds:[],isLoading:!1,isInitialized:!1,initializeFavorites:(t=(0,a.A)(c().mark(function t(){var n;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r().isInitialized){t.next=2;break}return t.abrupt("return");case 2:return e({isLoading:!0}),t.prev=3,t.next=6,(0,o.tu)();case 6:(n=t.sent).success&&e({favoriteIds:n.templateIds,isInitialized:!0}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("Error initializing favorite templates:",t.t0);case 13:return t.prev=13,e({isLoading:!1}),t.finish(13);case 16:case"end":return t.stop()}},t,null,[[3,10,13,16]])})),function(){return t.apply(this,arguments)}),addFavorite:(s=(0,a.A)(c().mark(function r(t){return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e(function(e){return{favoriteIds:[].concat((0,n.A)(e.favoriteIds),[t])}}),r.next=4,(0,o.y4)(t);case 4:if(r.sent.success){r.next=8;break}return e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.abrupt("return",!1);case 8:return r.abrupt("return",!0);case 11:return r.prev=11,r.t0=r.catch(0),console.error("Error adding template to favorites:",r.t0),e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.abrupt("return",!1);case 16:case"end":return r.stop()}},r,null,[[0,11]])})),function(e){return s.apply(this,arguments)}),removeFavorite:(u=(0,a.A)(c().mark(function r(t){return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e(function(e){return{favoriteIds:e.favoriteIds.filter(function(e){return e!==t})}}),r.next=4,(0,o.mO)(t);case 4:if(r.sent.success){r.next=8;break}return e(function(e){return{favoriteIds:[].concat((0,n.A)(e.favoriteIds),[t])}}),r.abrupt("return",!1);case 8:return r.abrupt("return",!0);case 11:return r.prev=11,r.t0=r.catch(0),console.error("Error removing template from favorites:",r.t0),e(function(e){return{favoriteIds:[].concat((0,n.A)(e.favoriteIds),[t])}}),r.abrupt("return",!1);case 16:case"end":return r.stop()}},r,null,[[0,11]])})),function(e){return u.apply(this,arguments)}),toggleFavorite:(i=(0,a.A)(c().mark(function e(t){var n,a,s,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=r()).isFavorite,s=n.addFavorite,u=n.removeFavorite,!a(t)){e.next=8;break}return e.next=5,u(t);case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,s(t);case 11:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),isFavorite:function(e){return r().favoriteIds.includes(e)}}})},72185:(e,r,t)=>{t(43081),t(73317),t(73341),t(36423)},73341:(e,r,t)=>{var n=t(42969),a=t(63857),s=t(43081),c=t.n(s),u=t(98877),o=t.n(u),i=t(21962),p=t(22503),l=t(96884),f=t(36423),v=t(65364);function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function m(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(Object(t),!0).forEach(function(r){(0,n.A)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var d=function(){var e=(0,a.A)(c().mark(function e(r){var t,n,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(f.A.API_URL,"/auth/refresh-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r.refreshToken})});case 3:return n=e.sent,e.next=6,n.json();case 6:return a=e.sent,e.abrupt("return",m(m({},r),{},{accessToken:a.accessToken,accessTokenExpires:Date.now()+864e5,refreshToken:null!=(t=a.refreshToken)?t:r.refreshToken}));case 10:return e.prev=10,e.t0=e.catch(0),console.error("RefreshAccessTokenError",e.t0),e.abrupt("return",m(m({},r),{},{error:"RefreshAccessTokenError"}));case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(r){return e.apply(this,arguments)}}(),g={providers:[(0,i.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},remember:{label:"Remember",type:"boolean"}},authorize:function(e){return(0,a.A)(c().mark(function r(){var t,n;return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(!(null!=e&&e.email)||!(null!=e&&e.password))){r.next=3;break}throw Error("Email v\xe0 mật khẩu l\xe0 bắt buộc");case 3:return r.next=5,fetch("".concat(f.A.API_URL,"/auth/signin"),{method:"POST",body:JSON.stringify({email:e.email,password:e.password,remember:"true"===e.remember}),headers:{"Content-Type":"application/json"}});case 5:return t=r.sent,r.next=8,t.json();case 8:if(n=r.sent,!(t.ok&&n)){r.next=11;break}return r.abrupt("return",{id:n.user.id,email:n.user.email,name:n.user.name||null,avatar:n.user.avatar||null,accessToken:n.accessToken,refreshToken:n.refreshToken,emailVerified:n.user.emailVerified,provider:"credentials",role:n.user.role,plan:n.user.plan});case 11:throw Error(n.error||"Invalid credentials");case 14:throw r.prev=14,r.t0=r.catch(0),Error(r.t0.message);case 17:case"end":return r.stop()}},r,null,[[0,14]])}))()}}),(0,p.A)({clientId:v.env.GOOGLE_ID,clientSecret:v.env.GOOGLE_SECRET}),(0,l.A)({clientId:v.env.FACEBOOK_ID,clientSecret:v.env.FACEBOOK_SECRET})],callbacks:{jwt:function(e){return(0,a.A)(c().mark(function r(){var t,n,a,s,u,o,i,p,l,v,h,g;return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.token,n=e.user,a=e.account,s=e.trigger,u=e.session,"update"===s&&(null!=u&&null!=(o=u.user)&&o.emailVerified&&(t.emailVerified=u.user.emailVerified),null!=u&&null!=(i=u.user)&&i.name&&(t.name=u.user.name),null!=u&&null!=(p=u.user)&&p.avatar&&(t.avatar=u.user.avatar),null!=u&&null!=(l=u.user)&&l.email&&(t.email=u.user.email),null!=u&&null!=(v=u.user)&&v.plan&&(t.plan=u.user.plan)),n&&(t.provider=n.provider,t.accessToken=n.accessToken,t.avatar=n.avatar,t.refreshToken=n.refreshToken,t.accessTokenExpires=Date.now()+(n.remember?6048e5:864e5),t.emailVerified=n.emailVerified,t.role=n.role,t.plan=n.plan),(null==a?void 0:a.type)!=="oauth"){r.next=20;break}return r.prev=4,r.next=7,fetch("".concat(f.A.API_URL,"/auth/social-auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,name:t.name,avatar:t.picture,provider:a.provider,providerAccountId:a.providerAccountId})});case 7:return h=r.sent,r.next=10,h.json();case 10:if(g=r.sent,h.ok){r.next=13;break}throw Error(g.error||"Lỗi khi đăng nhập bằng Google hoặc Facebook, vui l\xf2ng thử lại");case 13:h.ok&&(t.avatar=g.user.avatar,t.name=g.user.name,t.email=g.user.email,t.accessToken=g.accessToken,t.refreshToken=g.refreshToken,t.accessTokenExpires=Date.now()+864e5,t.emailVerified=g.user.emailVerified,t.provider=g.user.provider,t.role=g.user.role,t.plan=g.user.plan),r.next=20;break;case 16:return r.prev=16,r.t0=r.catch(4),console.error("Social auth error next-auth:",r.t0),r.abrupt("return",m(m({},t),{},{error:r.t0.message}));case 20:if(!("number"==typeof t.accessTokenExpires&&Date.now()<t.accessTokenExpires)){r.next=22;break}return r.abrupt("return",t);case 22:return r.abrupt("return",d(t));case 23:case"end":return r.stop()}},r,null,[[4,16]])}))()},session:function(e){return(0,a.A)(c().mark(function r(){var t,n;return c().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.session,n=e.token,r.abrupt("return",m(m({},t),{},{user:{email:n.email,name:n.name||null,avatar:n.avatar||null,emailVerified:n.emailVerified,provider:n.provider,role:n.role,plan:n.plan},accessToken:n.accessToken,remember:n.remember}));case 2:case"end":return r.stop()}},r)}))()}},pages:{signIn:"/login",error:"/auth/error"},secret:v.env.NEXTAUTH_SECRET,session:{strategy:"jwt",maxAge:2592e3},jwt:{maxAge:2592e3}};o()(g)}}]);